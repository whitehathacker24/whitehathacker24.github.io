<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Math Bot</title>
    <style>
        /* Add some basic styling for better appearance */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #chat-box {
            width: 300px;
            border: 1px solid #ccc;
            padding: 10px;
            overflow-y: scroll;
            height: 200px;
        }
    </style>
</head>
<body>
    <h1>Advanced Math Bot</h1>
    <div>
        <label for="user-input">Ask a question:</label>
        <input type="text" id="user-input" />
        <button onclick="askQuestion()">Ask</button>
        <button onclick="clearChat()">Clear Chat</button>
    </div>
    <div id="chat-box"></div>

    <!-- Include math.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/10.7.1/math.min.js"></script>
    <script>
        // Load previous questions and answers from local storage (if any)
        let botMemory = JSON.parse(localStorage.getItem('botMemory')) || {};

        // Function to save user input and bot's answer in local storage
        function saveUserInputAndAnswer(userInput, answer) {
            botMemory[userInput] = answer;
            localStorage.setItem('botMemory', JSON.stringify(botMemory));
        }

        // Function to directly evaluate math expressions using math.js
        function solveMathExpression(expression) {
            try {
                const result = math.evaluate(expression);
                return result;
            } catch (error) {
                return null;
            }
        }

        // Function to handle math word problems
        function solveMathWordProblem(problem) {
            const keywords = ['plus', 'add', 'sum', 'total', 'minus', 'subtract', 'difference', 'times', 'multiply', 'multiplied', 'product', 'divided', 'quotient', 'how many', 'how much'];

            for (const keyword of keywords) {
                if (problem.includes(keyword)) {
                    try {
                        const numbers = problem.match(/-?\d+(?:\.\d+)?/g).map(Number);
                        const operation = problem.includes('plus') || problem.includes('add') || problem.includes('sum') || problem.includes('total') ? 'add' :
                            problem.includes('minus') || problem.includes('subtract') || problem.includes('difference') ? 'subtract' :
                            problem.includes('times') || problem.includes('multiply') || problem.includes('multiplied') ? 'multiply' :
                            problem.includes('divided') || problem.includes('quotient') ? 'divide' : '';

                        if (operation === 'add') {
                            return numbers.reduce((a, b) => a + b, 0);
                        } else if (operation === 'subtract') {
                            return numbers.reduce((a, b) => a - b);
                        } else if (operation === 'multiply') {
                            return numbers.reduce((a, b) => a * b, 1);
                        } else if (operation === 'divide') {
                            return numbers.reduce((a, b) => a / b);
                        }
                    } catch (error) {
                        return null;
                    }
                }
            }
            return null;
        }

        // Function to handle temperature conversions
        function convertTemperature(userInput) {
            const keywords = ['celsius', 'fahrenheit', 'kelvin'];

            for (const keyword of keywords) {
                if (userInput.includes(keyword)) {
                    try {
                        const temp = parseFloat(userInput.match(/-?\d+(?:\.\d+)?/g)[0]);
                        if (!isNaN(temp)) {
                            if (userInput.includes('celsius') && userInput.includes('fahrenheit')) {
                                return (temp * 9 / 5) + 32;
                            } else if (userInput.includes('celsius') && userInput.includes('kelvin')) {
                                return temp + 273.15;
                            } else if (userInput.includes('fahrenheit') && userInput.includes('celsius')) {
                                return (temp - 32) * 5 / 9;
                            } else if (userInput.includes('fahrenheit') && userInput.includes('kelvin')) {
                                return (temp - 32) * 5 / 9 + 273.15;
                            } else if (userInput.includes('kelvin') && userInput.includes('celsius')) {
                                return temp - 273.15;
                            } else if (userInput.includes('kelvin') && userInput.includes('fahrenheit')) {
                                return (temp - 273.15) * 9 / 5 + 32;
                            }
                        }
                    } catch (error) {
                        return null;
                    }
                }
            }
            return null;
        }

        // Function to generate a random number within the specified range
        function generateRandomNumber(userInput) {
            const match = userInput.match(/-?\d+(?:\.\d+)?/g);
            if (match && match.length >= 2) {
                const min = parseFloat(match[0]);
                const max = parseFloat(match[1]);
                if (!isNaN(min) && !isNaN(max)) {
                    return Math.floor(Math.random() * (max - min + 1)) + min;
                }
            }
            return null;
        }

        // Function to perform operations (addition, multiplication, etc.) on a list of numbers
        function performOperationsOnList(userInput) {
            const keywords = ['add', 'multiply', 'sum', 'product'];

            for (const keyword of keywords) {
                if (userInput.includes(keyword)) {
                    try {
                        const list = userInput.match(/-?\d+(?:\.\d+)?/g).map(Number);
                        const operation = keyword === 'add' || keyword === 'sum' ? 'add' : keyword === 'multiply' || keyword === 'product' ? 'multiply' : '';

                        if (operation === 'add') {
                            return list.reduce((a, b) => a + b, 0);
                        } else if (operation === 'multiply') {
                            return list.reduce((a, b) => a * b, 1);
                        }
                    } catch (error) {
                        return null;
                    }
                }
            }
            return null;
        }

        // Function to calculate the factorial of a number
        function calculateFactorial(userInput) {
            if (userInput.includes('factorial')) {
                try {
                    const number = parseInt(userInput.match(/-?\d+/g)[0]);
                    if (!isNaN(number)) {
                        if (number === 0 || number === 1) {
                            return 1;
                        } else {
                            let factorial = 1;
                            for (let i = 2; i <= number; i++) {
                                factorial *= i;
                            }
                            return factorial;
                        }
                    }
                } catch (error) {
                    return null;
                }
            }
            return null;
        }

        // Function to get the formula for a specific shape or concept
        function getFormula(userInput) {
            const formulaName = userInput.replace('formula for', '').trim();
            const formulas = {
                'area of ellipse': 'Area = π * a * b',
                'volume of sphere': 'Volume = (4/3) * π * r^3',
                'surface area of torus': 'Surface Area = 4 * π^2 * R * r',
                // Add more formulas here
                // ...
            };
            return formulas[formulaName.toLowerCase()] || null;
        }

        // Function to handle advanced math problems
        function solveAdvancedMathProblem(userInput) {
            // Check for math word problems
            const wordProblemResult = solveMathWordProblem(userInput);
            if (wordProblemResult !== null) {
                return wordProblemResult;
            }

            // Check for temperature conversion
            const tempConversionResult = convertTemperature(userInput);
            if (tempConversionResult !== null) {
                return tempConversionResult;
            }

            // Check for random number generation
            const randomNumberResult = generateRandomNumber(userInput);
            if (randomNumberResult !== null) {
                return randomNumberResult;
            }

            // Check for performing operations on a list
            const operationsOnListResult = performOperationsOnList(userInput);
            if (operationsOnListResult !== null) {
                return operationsOnListResult;
            }

            // Check for calculating factorial
            const factorialResult = calculateFactorial(userInput);
            if (factorialResult !== null) {
                return factorialResult;
            }

            // If none of the specific interactions match, use math.js to evaluate the expression
            return solveMathExpression(userInput);
        }

        // Function to handle user input and generate bot responses
        function botResponse(userInput) {
            // Check if the user is asking for a specific formula
            const formulaResult = getFormula(userInput);
            if (formulaResult !== null) {
                return formulaResult;
            }

            // Directly evaluate math expressions
            const mathResult = solveAdvancedMathProblem(userInput);
            if (mathResult !== null) {
                saveUserInputAndAnswer(userInput, mathResult);
                return `The answer to "${userInput}" is: ${mathResult}`;
            }

            // If it's a new question, prompt the user to provide an answer
            const newAnswer = prompt(`You asked: "${userInput}"\n\nBot doesn't know the answer. Please provide one:`);
            if (newAnswer) {
                saveUserInputAndAnswer(userInput, newAnswer);
                return `You asked: "${userInput}"\nBot: ${newAnswer}`;
            } else {
                return "I'm sorry, I couldn't understand your question.";
            }
        }

        // Function to handle user input and generate bot responses
        function askQuestion() {
            const userInput = document.getElementById('user-input').value;
            if (userInput.trim() === '') return; // Ignore empty questions

            const chatBox = document.getElementById('chat-box');

            // Get the bot's response based on user input
            const botResponseText = botResponse(userInput);

            // Show the user's question and bot's response in the chat box
            chatBox.innerHTML += `<p><strong>You:</strong> ${userInput}</p>`;
            chatBox.innerHTML += `<p><strong>Bot:</strong> ${botResponseText}</p>`;

            // Clear the input field after processing the question
            document.getElementById('user-input').value = '';

            // Scroll to the bottom of the chat box to show the latest message
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // Function to clear the chat history and local storage
        function clearChat() {
            const chatBox = document.getElementById('chat-box');
            chatBox.innerHTML = '';
            localStorage.removeItem('botMemory');
            botMemory = {};
        }

    </script>
</body>
</html>
